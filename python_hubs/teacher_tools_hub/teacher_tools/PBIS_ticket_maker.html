<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PBIS Ticket Maker ‚Äî W.L.E.A.D. (JPEG)</title>
  <style>
    :root{
      --bg:#f2f2f2;
      --card:#ffffff;
      --border:#d7d7d7;
      --text:#111111;
      --muted:#4a4a4a;

      --navy:#0b2a5b;
      --navy2:#123b7a;
      --gold:#f2c94c;

      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      overflow:hidden; /* NO SCROLL */
    }

    /* ===== WIDE SCREEN TOP BAR ===== */
    .topbar{
      position:relative;
      background:var(--navy);
      color:#fff;
      border-bottom:4px solid var(--gold);
      height:74px;
      display:flex;
      align-items:center;
      padding:0 14px;
      gap:12px;
      overflow:hidden;
    }
    .topbar::after{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(
        90deg,
        rgba(255,255,255,0.00) 0%,
        rgba(255,255,255,0.06) 25%,
        rgba(255,255,255,0.00) 55%,
        rgba(255,255,255,0.05) 85%,
        rgba(255,255,255,0.00) 100%
      );
      pointer-events:none;
      opacity:0.55;
    }
    .crest{
      width:44px;height:44px;
      border-radius:999px;
      border:3px solid var(--gold);
      background:rgba(255,255,255,0.12);
      display:grid;place-items:center;
      font-weight:1000;
      letter-spacing:0.06em;
      user-select:none;
      z-index:1;
    }
    .brand{
      flex:1;
      min-width:0;
      z-index:1;
    }
    .brand .t{
      margin:0;
      font-weight:1000;
      letter-spacing:0.10em;
      text-transform:uppercase;
      font-size:1.05rem;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand .s{
      margin:4px 0 0;
      font-weight:800;
      font-size:0.92rem;
      opacity:0.92;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .tiny{
      z-index:1;
      font-weight:900;
      font-size:0.92rem;
      opacity:0.95;
      white-space:nowrap;
    }

    .app{
      height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* ===== MAIN LAYOUT (NO SCROLL) ===== */
    .stage{
      flex:1 1 auto;
      min-height:0;
      padding:12px;
      display:flex;
      justify-content:center;
      align-items:stretch;
    }
    .panel{
      width:min(1220px, 100%);
      background:var(--card);
      border:2px solid var(--border);
      border-radius:var(--radius);
      padding:12px;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .row{
      display:flex;
      gap:12px;
      min-height:0;
      flex:1 1 auto;
    }
    .left, .right{
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
      padding:12px;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .left{ flex:1 1 560px; min-width:330px; }
    .right{ flex:1 1 560px; min-width:330px; }

    label{
      display:block;
      font-weight:1000;
      margin:8px 0 6px;
      color:var(--navy);
    }
    input[type="text"], textarea{
      width:100%;
      border:2px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
      font-size:1rem;
      outline:none;
      background:#fff;
      color:var(--text);
    }
    input:focus, textarea:focus{
      border-color:var(--navy2);
      box-shadow:0 0 0 3px rgba(18,59,122,0.12);
    }
    textarea{
      resize:none;
      height:72px; /* smaller for NO SCROLL */
      line-height:1.25rem;
      font-size:0.98rem;
    }

    /* ===== 3 ACTIVITIES SELECT ===== */
    .pickrow{
      display:flex;
      gap:10px;
      flex-wrap:nowrap;
    }
    .pick{
      flex:1 1 0px;
      border:2px solid var(--navy);
      background:#fff;
      color:var(--navy);
      border-radius:12px;
      padding:12px 10px;
      font-weight:1000;
      font-size:0.98rem;
      cursor:pointer;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      white-space:nowrap;
    }
    .pick.active{
      background:var(--navy);
      color:#fff;
      box-shadow:0 0 0 3px rgba(242,201,76,0.55) inset;
    }
    .pick:focus{outline:3px solid rgba(242,201,76,0.65); outline-offset:2px;}

    /* ===== PBIS CHECKS ===== */
    .checks{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
      border:2px solid var(--border);
      border-radius:12px;
      padding:10px;
      background:#fff;
    }
    .check{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      color:var(--navy);
    }
    .check input{ width:22px; height:22px; accent-color: var(--navy); }

    /* ===== ACTION BAR (NO SHIFT) ===== */
    .actions{
      margin-top:auto;
      padding-top:10px;
      border-top:1px solid var(--border);
      display:flex;
      gap:10px;
      justify-content:flex-end;
      align-items:center;
      flex-wrap:nowrap;
    }
    .btn{
      appearance:none;
      border:2px solid var(--navy);
      background:#fff;
      color:var(--navy);
      border-radius:12px;
      padding:10px 12px;
      font-weight:1000;
      font-size:0.95rem;
      cursor:pointer;
      user-select:none;
      width:170px;
      flex:0 0 170px;
    }
    .btn:focus{outline:3px solid rgba(242,201,76,0.65); outline-offset:2px;}
    .btn.gold{border-color:var(--gold); background:var(--gold); color:#111;}
    .btn.danger{border-color:#b00020; background:#b00020; color:#fff;}

    /* ===== RIGHT PREVIEW ===== */
    .statusline{
      margin:0;
      font-weight:1000;
      color:var(--navy);
    }

    .jpegbox{
      display:none;
      border:2px dashed var(--border);
      border-radius:12px;
      padding:10px;
      background:#fff;
    }
    .jpegbox img{
      width:100%;
      height:auto;
      display:block;
      border-radius:10px;
      border:1px solid var(--border);
    }

    .canvaswrap{
      border:3px solid var(--navy);
      border-radius:12px;
      overflow:hidden;
      background:#fff;
      flex:1 1 auto;
      min-height:0;
    }
    canvas{
      display:block;
      width:100%;
      height:100%; /* fill wrapper */
      background:#fff;
    }

    .toast{
      position:fixed;
      top:10px; left:50%;
      transform:translateX(-50%);
      background:var(--navy);
      color:#fff;
      border:3px solid var(--gold);
      border-radius:999px;
      padding:10px 14px;
      font-weight:1000;
      z-index:9999;
      display:none;
      max-width:92vw;
      text-align:center;
    }

    .hint{ margin:0; color:var(--muted); font-weight:800; }
    .tinyhint{ margin:0; color:var(--muted); font-weight:800; font-size:0.92rem; }

    /* Keep right side tall enough: top JPEG + canvas */
    .right{
      gap:10px;
    }
  </style>
</head>

<body>
  <div class="toast" id="toast"></div>

  <div class="app">
    <div class="topbar">
      <div class="crest">W</div>
      <div class="brand">
        <p class="t">PBIS Ticket Maker</p>
        <p class="s">We are L.E.A.Ders ‚Ä¢ Teacher First</p>
      </div>
      <div class="tiny" id="todayTiny">JPEG Ready</div>
    </div>

    <div class="stage">
      <div class="panel">
        <div class="row">
          <!-- LEFT -->
          <div class="left">
            <p class="statusline" id="statusLine">Tap an activity to add it to the preview.</p>

            <div class="pickrow" role="group" aria-label="Activities">
              <button class="pick" id="pickCheckin" type="button">‚úÖ CHECK IN</button>
              <button class="pick" id="pickReflect" type="button">üîÑ REFLECT</button>
              <button class="pick" id="pickGoal" type="button">‚≠ê GOAL</button>
            </div>

            <div style="display:flex; gap:10px; flex-wrap:nowrap;">
              <div style="flex:1 1 60%;">
                <label>Student</label>
                <input id="studentName" type="text" placeholder="Name"/>
              </div>
              <div style="flex:1 1 40%;">
                <label>Group</label>
                <input id="studentGroup" type="text" placeholder="Period"/>
              </div>
            </div>

            <label>PBIS Checks (5)</label>
            <div class="checks">
              <div class="check"><input type="checkbox" id="c1"><span>ENGAGE in SAFTEY</span></div>
              <div class="check"><input type="checkbox" id="c2"><span>LEARN TO EARN</span></div>
              <div class="check"><input type="checkbox" id="c3"><span>ALWAYS RESPECTFUL</span></div>
              <div class="check"><input type="checkbox" id="c4"><span>DO THE RIGHT THING</span></div>
              <div class="check"><input type="checkbox" id="c5"><span>MY GOAL POINT</span></div>
            </div>

            <!-- Inputs are always visible; preview only shows ones that are selected -->
            <label>CHECK IN</label>
            <textarea id="a1" placeholder="Today I will‚Ä¶"></textarea>

            <label>REFLECT</label>
            <textarea id="b1" placeholder="What happened?"></textarea>

            <label>GOAL</label>
            <textarea id="g1" placeholder="My goal point is‚Ä¶"></textarea>

            <div class="actions">
              <button class="btn gold" id="makeJpeg" type="button">Make JPEG (Preview)</button>
              <button class="btn" id="saveJpeg" type="button">Save JPEG</button>
              <button class="btn danger" id="clear" type="button">Clean Up</button>
            </div>

            <p class="tinyhint" id="savedAt">‚Äî</p>
          </div>

          <!-- RIGHT -->
          <div class="right">
            <p class="statusline">Preview</p>

            <!-- JPEG preview appears TOP -->
            <div class="jpegbox" id="jpegBox">
              <p class="hint" style="margin:0 0 8px;">
                JPEG Preview (student). On iPhone: long-press ‚Üí Save Image.
              </p>
              <img id="jpegImg" alt="Ticket JPEG Preview"/>
            </div>

            <!-- Canvas is always visible below -->
            <div class="canvaswrap" id="canvasWrap">
              <canvas id="ticket"></canvas>
            </div>

            <p class="tinyhint"><span id="today"></span></p>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  const $ = (s, el=document)=> el.querySelector(s);

  const store = {
    get(k, fallback){
      try{ const v = localStorage.getItem(k); return v ? JSON.parse(v) : fallback; }
      catch(e){ return fallback; }
    },
    set(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){} }
  };

  function toast(msg){
    const t = $("#toast");
    t.textContent = msg;
    t.style.display = "block";
    clearTimeout(toast._t);
    toast._t = setTimeout(()=> t.style.display="none", 1400);
  }

  // date
  const now = new Date();
  $("#today").textContent = "Date: " + now.toLocaleDateString();
  $("#todayTiny").textContent = now.toLocaleDateString();

  // activity picks (progressively adds to preview)
  const picks = {
    checkin: $("#pickCheckin"),
    reflect: $("#pickReflect"),
    goal: $("#pickGoal"),
  };

  let selected = store.get("pbis_selected_3", {checkin:false, reflect:false, goal:false});

  function applyPicks(){
    picks.checkin.classList.toggle("active", !!selected.checkin);
    picks.reflect.classList.toggle("active", !!selected.reflect);
    picks.goal.classList.toggle("active", !!selected.goal);

    const count = (selected.checkin?1:0)+(selected.reflect?1:0)+(selected.goal?1:0);
    $("#statusLine").textContent = count === 0
      ? "Tap an activity to add it to the preview."
      : ("Selected: " + (selected.checkin?"CHECK IN ":"") + (selected.reflect?"REFLECT ":"") + (selected.goal?"GOAL":"")).trim();

    // Hide jpeg preview when selection changes (keeps progression clean)
    $("#jpegBox").style.display = "none";

    // Update preview immediately
    drawTicket(false);
  }

  function togglePick(key){
    selected[key] = !selected[key];
    store.set("pbis_selected_3", selected);
    applyPicks();
  }

  picks.checkin.addEventListener("click", ()=>togglePick("checkin"));
  picks.reflect.addEventListener("click", ()=>togglePick("reflect"));
  picks.goal.addEventListener("click", ()=>togglePick("goal"));
  applyPicks();

  // form fields
  const fields = {
    name: $("#studentName"),
    group: $("#studentGroup"),
    c1: $("#c1"), c2: $("#c2"), c3: $("#c3"), c4: $("#c4"), c5: $("#c5"),
    a1: $("#a1"),
    b1: $("#b1"),
    g1: $("#g1"),
  };

  function collect(){
    return {
      selected,
      name: (fields.name.value||"").trim(),
      group: (fields.group.value||"").trim(),
      checks: {
        c1: fields.c1.checked,
        c2: fields.c2.checked,
        c3: fields.c3.checked,
        c4: fields.c4.checked,
        c5: fields.c5.checked,
      },
      a1: fields.a1.value||"",
      b1: fields.b1.value||"",
      g1: fields.g1.value||"",
    };
  }

  function restore(){
    const v = store.get("pbis_ticket_v4", null);
    if(!v) return;

    if(v.selected){
      selected = v.selected;
      store.set("pbis_selected_3", selected);
    }
    fields.name.value = v.name || "";
    fields.group.value = v.group || "";
    if(v.checks){
      fields.c1.checked = !!v.checks.c1;
      fields.c2.checked = !!v.checks.c2;
      fields.c3.checked = !!v.checks.c3;
      fields.c4.checked = !!v.checks.c4;
      fields.c5.checked = !!v.checks.c5;
    }
    fields.a1.value = v.a1 || "";
    fields.b1.value = v.b1 || "";
    fields.g1.value = v.g1 || "";

    const stamp = store.get("pbis_saved_at_v4","‚Äî");
    $("#savedAt").textContent = stamp === "‚Äî" ? "‚Äî" : ("Saved: " + stamp);
  }
  restore();
  applyPicks();

  // autosave (quiet)
  Object.values(fields).forEach(el=>{
    el.addEventListener("input", ()=>{
      store.set("pbis_ticket_v4", collect());
      drawTicket(false);
    });
    el.addEventListener("change", ()=>{
      store.set("pbis_ticket_v4", collect());
      drawTicket(false);
    });
  });

  function softSave(){
    store.set("pbis_ticket_v4", collect());
    const stamp = new Date().toLocaleString();
    store.set("pbis_saved_at_v4", stamp);
    $("#savedAt").textContent = "Saved: " + stamp;
  }

  // canvas sizing: fill remaining right panel
  const canvas = $("#ticket");
  const ctx = canvas.getContext("2d", { alpha:false });

  function fitCanvas(){
    const wrap = $("#canvasWrap");
    const w = Math.max(1, wrap.clientWidth);
    const h = Math.max(1, wrap.clientHeight);

    const dpr = Math.max(1, window.devicePixelRatio || 1);
    canvas.width = Math.floor(w * dpr);
    canvas.height = Math.floor(h * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    drawTicket(true);
  }
  window.addEventListener("resize", fitCanvas);
  setTimeout(fitCanvas, 50);

  function wrapText(text, maxChars){
    const words = (text||"").replace(/\r/g,"").split(/\s+/).filter(Boolean);
    const lines = [];
    let line = "";
    for(const w of words){
      const test = line ? (line + " " + w) : w;
      if(test.length > maxChars){
        if(line) lines.push(line);
        line = w;
      }else{
        line = test;
      }
    }
    if(line) lines.push(line);
    return lines;
  }

  function checkLabel(k){
    if(k==="c1") return "ENGAGE in SAFTEY";
    if(k==="c2") return "LEARN TO EARN";
    if(k==="c3") return "ALWAYS RESPECTFUL";
    if(k==="c4") return "DO THE RIGHT THING";
    if(k==="c5") return "MY GOAL POINT";
    return k;
  }

  function drawTicket(blank=false){
    const wrap = $("#canvasWrap");
    const w = wrap.clientWidth;
    const h = wrap.clientHeight;

    const v = collect();

    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0,0,w,h);

    // header stripe
    ctx.fillStyle = "#0b2a5b";
    ctx.fillRect(0,0,w,62);
    ctx.fillStyle = "#f2c94c";
    ctx.fillRect(0,60,w,6);

    // left crest
    const cx=28, cy=31, r=22;
    ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fillStyle="#f2c94c"; ctx.fill();
    ctx.beginPath(); ctx.arc(cx,cy,r-5,0,Math.PI*2); ctx.fillStyle="#0b2a5b"; ctx.fill();
    ctx.fillStyle="#ffffff";
    ctx.font="900 16px system-ui, -apple-system, Segoe UI, Arial";
    ctx.textAlign="center"; ctx.textBaseline="middle";
    ctx.fillText("W", cx, cy);

    // header text
    ctx.textAlign="left"; ctx.textBaseline="alphabetic";
    ctx.fillStyle="#ffffff";
    ctx.font="1000 15px system-ui, -apple-system, Segoe UI, Arial";
    ctx.fillText("PBIS TICKET ‚Ä¢ W.L.E.A.D.", 62, 30);
    ctx.font="900 12px system-ui, -apple-system, Segoe UI, Arial";
    ctx.fillStyle="rgba(255,255,255,0.92)";
    ctx.fillText("We are L.E.A.Ders ‚Ä¢ Teacher First", 62, 50);

    // meta
    ctx.fillStyle="#123b7a";
    ctx.fillRect(w-250, 10, 240, 44);
    ctx.fillStyle="#ffffff";
    ctx.font="900 12px system-ui, -apple-system, Segoe UI, Arial";
    const dateStr = new Date().toLocaleDateString();
    ctx.fillText("Date: " + dateStr, w-238, 28);
    ctx.fillText("Group: " + (v.group || "‚Äî"), w-238, 46);

    // student
    ctx.fillStyle="#111";
    ctx.font="1000 16px system-ui, -apple-system, Segoe UI, Arial";
    ctx.textAlign="left";
    ctx.fillText("Student: " + (v.name || "________________"), 16, 92);

    // selected line
    const selLine = "Selected: " +
      (v.selected.checkin ? "CHECK IN " : "") +
      (v.selected.reflect ? "REFLECT " : "") +
      (v.selected.goal ? "GOAL" : "");
    ctx.fillStyle="#0b2a5b";
    ctx.font="1000 13px system-ui, -apple-system, Segoe UI, Arial";
    ctx.fillText(selLine.trim() || "Selected: ‚Äî", 16, 118);

    // checks box
    const boxX=16, boxY=130, boxW=w-32, boxH=118;
    ctx.strokeStyle="#d7d7d7";
    ctx.lineWidth=2;
    ctx.strokeRect(boxX, boxY, boxW, boxH);

    ctx.fillStyle="#0b2a5b";
    ctx.font="1000 12px system-ui, -apple-system, Segoe UI, Arial";
    ctx.fillText("PBIS CHECKS:", boxX+10, boxY+22);

    const checks = v.checks;
    const items = ["c1","c2","c3","c4","c5"];
    ctx.font="900 12px system-ui, -apple-system, Segoe UI, Arial";
    let x=boxX+10, y=boxY+44;
    const colGap = Math.floor((boxW-20)/2);

    items.forEach((k, idx)=>{
      const on = !!checks[k];
      const col = (idx<3) ? 0 : 1;
      const row = (idx<3) ? idx : (idx-3);
      const px = x + col*colGap;
      const py = y + row*24;

      ctx.strokeStyle="#0b2a5b";
      ctx.lineWidth=2;
      ctx.strokeRect(px, py-12, 16, 16);
      if(on){
        ctx.fillStyle="#f2c94c";
        ctx.fillRect(px+3, py-9, 10, 10);
      }
      ctx.fillStyle="#0b2a5b";
      ctx.fillText(checkLabel(k), px+24, py+2);
    });

    // body box
    const bodyX=16, bodyY=258, bodyW=w-32, bodyH=h-258-40;
    ctx.strokeStyle="#d7d7d7";
    ctx.lineWidth=2;
    ctx.strokeRect(bodyX, bodyY, bodyW, bodyH);

    ctx.fillStyle="#0b2a5b";
    ctx.font="1000 12px system-ui, -apple-system, Segoe UI, Arial";
    ctx.fillText("STUDENT TEXT:", bodyX+10, bodyY+22);

    ctx.fillStyle="#111";
    ctx.font="900 13px system-ui, -apple-system, Segoe UI, Arial";

    let lines = [];
    if(v.selected.checkin){
      lines.push("CHECK IN:");
      lines = lines.concat(wrapText(v.a1 || (blank ? "" : "________________"), 60).slice(0,3));
      lines.push("");
    }
    if(v.selected.reflect){
      lines.push("REFLECT:");
      lines = lines.concat(wrapText(v.b1 || "", 60).slice(0,3));
      lines.push("");
    }
    if(v.selected.goal){
      lines.push("GOAL:");
      lines = lines.concat(wrapText(v.g1 || "", 60).slice(0,3));
    }
    if(!v.selected.checkin && !v.selected.reflect && !v.selected.goal){
      lines = ["(Tap an activity to add it to the ticket.)"];
    }

    let ty = bodyY+46;
    const maxY = bodyY + bodyH - 14;
    for(const ln of lines){
      if(ty > maxY) break;
      ctx.fillText(ln, bodyX+10, ty);
      ty += 18;
    }

    // footer
    ctx.fillStyle="#0b2a5b";
    ctx.font="900 11px system-ui, -apple-system, Segoe UI, Arial";
    ctx.textAlign="left";
    ctx.fillText("W.L.E.A.D. ‚Ä¢ PBIS", 16, h-14);
    ctx.textAlign="right";
    ctx.fillStyle="#123b7a";
    ctx.fillText("Student copy (JPEG)", w-16, h-14);
    ctx.textAlign="left";
  }

  function makeJPEGPreview(){
    // Always draw latest, then show preview at TOP
    drawTicket(false);
    try{
      const url = canvas.toDataURL("image/jpeg", 0.92);
      $("#jpegImg").src = url;
      $("#jpegBox").style.display = "block";
      toast("JPEG preview ready ‚úì");
    }catch(e){
      toast("JPEG preview failed");
    }
  }

  function downloadJPEG(){
    drawTicket(false);

    const filenameBase = (fields.name.value || "pbis_ticket").trim().replace(/\s+/g, "_");
    const filename = filenameBase ? (filenameBase + ".jpg") : "pbis_ticket.jpg";

    if(canvas.toBlob){
      canvas.toBlob((blob)=>{
        if(!blob){ toast("Download failed"); return; }
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(()=> URL.revokeObjectURL(url), 800);
        toast("Downloaded ‚úì");
      }, "image/jpeg", 0.92);
    } else {
      try{
        const url = canvas.toDataURL("image/jpeg", 0.92);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        toast("Downloaded ‚úì");
      }catch(e){
        toast("Download failed");
      }
    }
  }

  $("#makeJpeg").addEventListener("click", ()=>{
    // Preview only (progression)
    softSave();
    makeJPEGPreview();
  });

  $("#saveJpeg").addEventListener("click", ()=>{
    // Save + download (boomer-proof)
    softSave();
    downloadJPEG();
  });

  $("#clear").addEventListener("click", ()=>{
    fields.name.value = "";
    fields.group.value = "";
    fields.c1.checked = fields.c2.checked = fields.c3.checked = fields.c4.checked = fields.c5.checked = false;
    fields.a1.value = "";
    fields.b1.value = "";
    fields.g1.value = "";
    selected = {checkin:false, reflect:false, goal:false};
    store.set("pbis_selected_3", selected);
    store.set("pbis_ticket_v4", collect());
    store.set("pbis_saved_at_v4", "‚Äî");
    $("#savedAt").textContent = "‚Äî";
    $("#jpegBox").style.display = "none";
    applyPicks();
    drawTicket(true);
    toast("Cleared");
  });

  // initial draw
  setTimeout(()=> { fitCanvas(); drawTicket(true); }, 60);
</script>
</body>
</html>
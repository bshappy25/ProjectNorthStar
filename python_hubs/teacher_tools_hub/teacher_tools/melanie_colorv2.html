<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ms. Melanie‚Äôs Coloring Studio + Signature Export</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Comic Sans MS','Chalkboard SE','Comic Neue',cursive,system-ui;background:linear-gradient(135deg,#ffd6e8,#f9a8d4);min-height:100vh;display:grid;place-items:center;padding:20px}
.container{width:100%;max-width:1200px;background:#fff;border-radius:24px;padding:32px;box-shadow:0 20px 60px rgba(0,0,0,.25);border:6px solid #f472b6;position:relative}
h1{text-align:center;font-size:clamp(2.1rem,4vw,3rem);color:#db2777;margin-bottom:10px}
.subtitle{text-align:center;color:#9d174d;font-size:1.15rem;margin-bottom:22px}
.hub{text-align:center}
.tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;max-width:900px;margin:0 auto 28px}
.tile{border:4px dashed #f9a8d4;border-radius:18px;padding:40px 20px;font-size:1.15rem;font-weight:800;color:#9d174d;background:#fff0f6;cursor:pointer;transition:.25s}
.tile:hover{transform:translateY(-6px);box-shadow:0 8px 20px rgba(219,39,119,.25);border-color:#db2777}
.start-btn{padding:16px 48px;font-size:1.35rem;border-radius:999px;border:none;background:linear-gradient(135deg,#f472b6,#ec4899);color:#fff;cursor:pointer;font-weight:900;transition:.25s}
.start-btn:hover{transform:translateY(-3px);box-shadow:0 10px 25px rgba(219,39,119,.4)}
.app{display:none;margin-top:10px}
.toolbar{display:flex;gap:12px;justify-content:center;margin:10px 0 14px;flex-wrap:wrap}
.tool-btn{padding:10px 16px;border-radius:12px;border:none;cursor:pointer;font-weight:900;font-size:1rem}
.spicy{background:linear-gradient(135deg,#ff6b6b,#ff8fab);color:#fff}
.spicy.active{box-shadow:inset 0 2px 6px rgba(0,0,0,.25);filter:saturate(1.15)}
.clear{background:#fde68a;color:#78350f}
.export{background:linear-gradient(135deg,#a78bfa,#ec4899);color:#fff}
.sign{background:linear-gradient(135deg,#34d399,#60a5fa);color:#0b1020}
.board{max-width:980px;margin:0 auto}
.artboard{background:#fff;border:4px solid #f472b6;border-radius:18px;padding:12px;box-shadow:0 10px 30px rgba(219,39,119,.18)}
#canvas{display:block;width:100%;height:auto;border-radius:14px;background:#fff;touch-action:none}
small.tip{display:block;text-align:center;color:#9d174d;margin-top:10px;font-weight:700}
.kq-wand{display:inline-block;font:700 14px/1 system-ui,Segoe UI Emoji,Apple Color Emoji,Noto Color Emoji;transform-origin:50% 90%;animation:kqPulse .9s ease-in-out infinite,kqWiggle 2.2s ease-in-out infinite;filter:drop-shadow(0 0 10px rgba(255,255,255,.35))}
.kq-wand:after{content:"ü™Ñ‚ú®";letter-spacing:.02em;background:linear-gradient(90deg,#60a5fa,#fb923c,#f472b6,#34d399,#fbbf24,#60a5fa);-webkit-background-clip:text;background-clip:text;color:transparent;filter:drop-shadow(0 0 10px rgba(255,255,255,.25));animation:kqGlow 1.1s ease-in-out infinite}
@keyframes kqPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
@keyframes kqWiggle{0%,100%{transform:rotate(-4deg)}50%{transform:rotate(6deg)}}
@keyframes kqGlow{0%,100%{opacity:.85}50%{opacity:1}}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:9999}
.card{width:min(980px,96vw);background:#fff;border-radius:26px;padding:22px;box-shadow:0 30px 90px rgba(0,0,0,.35);border:5px solid rgba(96,165,250,.65);position:relative}
.card h2{text-align:center;color:#1f3b7a;font:900 clamp(22px,3vw,30px)/1.1 "Comic Sans MS","Chalkboard SE",cursive,system-ui;margin-bottom:6px}
.card .sub{text-align:center;color:#6b7280;font-weight:800;margin-bottom:14px}
.sigwrap{position:relative;height:170px;border-radius:18px;overflow:hidden;border:3px solid rgba(96,165,250,.55);background:#fff}
#sig{width:100%;height:100%;display:block;touch-action:none}
#sigPh{position:absolute;inset:0;display:grid;place-items:center;color:rgba(120,120,120,.7);font:900 22px/1 "Comic Sans MS","Chalkboard SE",cursive,system-ui;pointer-events:none;user-select:none}
.row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:14px}
.row button{appearance:none;border:none;cursor:pointer;border-radius:14px;padding:12px 14px;font-weight:950}
.b1{background:rgba(52,211,153,.25);border:2px solid rgba(52,211,153,.55)}
.b2{background:rgba(251,191,36,.22);border:2px solid rgba(251,191,36,.55)}
.b3{background:rgba(244,114,182,.18);border:2px solid rgba(244,114,182,.55)}
.x{position:absolute;right:14px;top:12px;width:42px;height:42px;border-radius:14px;background:rgba(0,0,0,.06);font-weight:1000}
</style>
</head><body>
<div class="container">
  <h1>üé® Ms. Melanie‚Äôs Coloring Studio</h1>
  <div class="subtitle">Create ‚Ä¢ Color ‚Ä¢ Rainbow Pepper üåàüå∂Ô∏è</div>

  <div class="hub" id="hub">
    <div class="tiles">
      <div class="tile" onclick="comingSoon()">üå∏ Coming Soon</div>
      <div class="tile" onclick="comingSoon()">ü¶Ñ Coming Soon</div>
      <div class="tile" onclick="comingSoon()">üåà Coming Soon</div>
      <div class="tile" onclick="comingSoon()">‚ú® Coming Soon</div>
    </div>
    <button class="start-btn" onclick="start()">Start Coloring</button>
  </div>

  <div class="app" id="app">
    <div class="toolbar">
      <button class="tool-btn spicy" id="spicyBtn" onclick="toggleRainbowPepper()">üåàüå∂Ô∏è Rainbow Pepper</button>
      <button class="tool-btn clear" onclick="clearCanvas()">üßº Clear</button>
      <button class="tool-btn export" onclick="exportJPG(false)">üì∏ Export JPEG</button>
      <button class="tool-btn sign" onclick="openSig()">‚úçÔ∏è Sign & Export JPEG</button>
    </div>

    <div class="board">
      <div class="artboard" id="artboard">
        <canvas id="canvas" width="900" height="600"></canvas>
      </div>
      <small class="tip"><span class="kq-wand" aria-hidden="true"></span> draw inside the canvas ‚Ä¢ export makes a JPEG ‚Ä¢ signature stamps bottom-right</small>
    </div>
  </div>
</div>

<div class="modal" id="sigModal" aria-hidden="true">
  <div class="card">
    <button class="x" onclick="closeSig()" aria-label="Close">‚úï</button>
    <h2>Signature Panel</h2>
    <div class="sub">Add your signature ‚Üí bottom-right on final JPEG</div>
    <div class="sigwrap">
      <canvas id="sig"></canvas>
      <div id="sigPh">Your signature‚Ä¶</div>
    </div>
    <div class="row">
      <button class="b1" id="saveSig">Add Signature &amp; Download JPEG</button>
      <button class="b2" id="skipSig">Skip &amp; Download JPEG</button>
      <button class="b3" id="clearSig">Clear Signature</button>
    </div>
  </div>
</div>

<script>
const hub=document.getElementById("hub"),app=document.getElementById("app");
const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");
const spicyBtn=document.getElementById("spicyBtn");
const artboard=document.getElementById("artboard");

// wand-based flash marker cursor (from code block)
const wandCursor=(()=>{const svg=`<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64">
<defs>
<linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
<stop offset="0" stop-color="#60a5fa"/><stop offset=".25" stop-color="#fb923c"/>
<stop offset=".5" stop-color="#f472b6"/><stop offset=".75" stop-color="#34d399"/>
<stop offset="1" stop-color="#fbbf24"/>
</linearGradient>
</defs>
<rect x="26" y="10" width="10" height="44" rx="5" fill="#0b1020" stroke="url(#g)" stroke-width="3"/>
<path d="M18 50 L30 14" stroke="url(#g)" stroke-width="4" stroke-linecap="round"/>
<path d="M34 54 L46 18" stroke="url(#g)" stroke-width="4" stroke-linecap="round"/>
<path d="M50 14 L54 16 L50 18 L48 22 L46 18 L42 16 L46 14 L48 10 Z" fill="#fff" opacity=".9"/>
<path d="M12 20 L15 21 L12 22 L11 25 L10 22 L7 21 L10 20 L11 17 Z" fill="#fff" opacity=".75"/>
</svg>`.trim();
return `url("data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}") 14 50, crosshair`;})();
canvas.style.cursor=wandCursor;

// app state
let drawing=false,rainbowPepper=false;
const PEN={width:7,shadowBlur:0,shadowColor:"rgba(0,0,0,0)"};
const rainbowPalette=["#ff3b30","#ff9500","#ffcc00","#34c759","#00c7be","#007aff","#5856d6","#af52de"];
let strokeColor="#db2777",rainbowIndex=0,last=null,prev=null;

function comingSoon(){alert("‚ú® This page is coming soon!\nWe‚Äôll add designs here later.");}
function start(){hub.style.display="none";app.style.display="block";canvas.style.cursor=wandCursor;}
function toggleRainbowPepper(){rainbowPepper=!rainbowPepper;spicyBtn.classList.toggle("active",rainbowPepper);}
function clearCanvas(){ctx.clearRect(0,0,canvas.width,canvas.height);}
function pickStrokeColor(){if(!rainbowPepper) return "#db2777"; const c=rainbowPalette[rainbowIndex%rainbowPalette.length]; rainbowIndex++; return c;}
function setInkStyle(color){
  ctx.strokeStyle=color; ctx.lineWidth=PEN.width; ctx.lineCap="round"; ctx.lineJoin="round";
  ctx.imageSmoothingEnabled=true; ctx.shadowBlur=PEN.shadowBlur; ctx.shadowColor=PEN.shadowColor;
}
function getCanvasPoint(e){return {x:e.offsetX,y:e.offsetY};}
function drawSmooth(p){
  if(!last){last=p;prev=p;ctx.beginPath();ctx.moveTo(p.x,p.y);return;}
  const mid1={x:(prev.x+last.x)/2,y:(prev.y+last.y)/2};
  const mid2={x:(last.x+p.x)/2,y:(last.y+p.y)/2};
  ctx.beginPath(); ctx.moveTo(mid1.x,mid1.y); ctx.quadraticCurveTo(last.x,last.y,mid2.x,mid2.y); ctx.stroke();
  prev=last; last=p;
}
canvas.addEventListener("pointerdown",(e)=>{
  drawing=true; canvas.setPointerCapture(e.pointerId);
  strokeColor=pickStrokeColor(); setInkStyle(strokeColor);
  const p=getCanvasPoint(e); last=null; prev=null;
  ctx.beginPath(); ctx.arc(p.x,p.y,PEN.width/2.2,0,Math.PI*2); ctx.fillStyle=strokeColor; ctx.fill();
  last=p; prev=p;
});
canvas.addEventListener("pointermove",(e)=>{if(!drawing) return; drawSmooth(getCanvasPoint(e));});
function endStroke(){drawing=false; last=null; prev=null;}
canvas.addEventListener("pointerup",endStroke);
canvas.addEventListener("pointercancel",endStroke);
canvas.addEventListener("mouseenter",()=>{canvas.style.cursor=wandCursor;});
canvas.addEventListener("mouseleave",()=>{canvas.style.cursor="default";});

// -------- signature modal + export --------
const sigModal=document.getElementById("sigModal");
const sig=document.getElementById("sig");
const sigPh=document.getElementById("sigPh");
const sctx=sig.getContext("2d");
let sigDraw=false,hasInk=false,sLast=null,sPrev=null;
const dpr=Math.max(1,devicePixelRatio||1);

function fitSig(){
  const r=sig.parentElement.getBoundingClientRect();
  sig.width=Math.floor(r.width*dpr); sig.height=Math.floor(r.height*dpr);
  sctx.setTransform(1,0,0,1,0,0); sctx.scale(dpr,dpr);
  sctx.clearRect(0,0,r.width,r.height);
  hasInk=false; sigPh.style.display="grid";
}
addEventListener("resize",()=>{if(sigModal.style.display==="flex") fitSig();});

function openSig(){sigModal.style.display="flex";sigModal.setAttribute("aria-hidden","false");fitSig();}
function closeSig(){sigModal.style.display="none";sigModal.setAttribute("aria-hidden","true");}

function sp(e){
  const r=sig.getBoundingClientRect();
  return {x:e.clientX-r.left,y:e.clientY-r.top};
}
function sDrawSmooth(p){
  if(!sLast){sLast=p;sPrev=p;sctx.beginPath();sctx.moveTo(p.x,p.y);return;}
  const mid1={x:(sPrev.x+sLast.x)/2,y:(sPrev.y+sLast.y)/2};
  const mid2={x:(sLast.x+p.x)/2,y:(sLast.y+p.y)/2};
  sctx.beginPath(); sctx.moveTo(mid1.x,mid1.y); sctx.quadraticCurveTo(sLast.x,sLast.y,mid2.x,mid2.y); sctx.stroke();
  sPrev=sLast; sLast=p;
}

sig.addEventListener("pointerdown",(e)=>{
  sig.setPointerCapture(e.pointerId); sigDraw=true; hasInk=true; sigPh.style.display="none";
  sctx.lineCap="round"; sctx.lineJoin="round"; sctx.strokeStyle="rgba(40,60,120,.92)"; sctx.lineWidth=5;
  const p=sp(e); sLast=null; sPrev=null;
  sctx.beginPath(); sctx.arc(p.x,p.y,2.4,0,Math.PI*2); sctx.fillStyle="rgba(40,60,120,.92)"; sctx.fill();
  sLast=p; sPrev=p;
});
sig.addEventListener("pointermove",(e)=>{if(!sigDraw) return; sDrawSmooth(sp(e));});
sig.addEventListener("pointerup",()=>{sigDraw=false;sLast=null;sPrev=null;});
sig.addEventListener("pointercancel",()=>{sigDraw=false;sLast=null;sPrev=null;});

document.getElementById("clearSig").onclick=()=>fitSig();
document.getElementById("skipSig").onclick=()=>exportJPG(false,true);
document.getElementById("saveSig").onclick=()=>exportJPG(true,true);

async function exportJPG(withSig,fromModal=false){
  if(fromModal) closeSig();
  const shot=await html2canvas(artboard,{backgroundColor:"#ffffff",scale:2,useCORS:true});
  const out=document.createElement("canvas");
  out.width=shot.width; out.height=shot.height;
  const octx=out.getContext("2d");
  octx.drawImage(shot,0,0);

  if(withSig && hasInk){
    const sigImg=new Image();
    sigImg.src=sig.toDataURL("image/png");
    await sigImg.decode().catch(()=>{});
    const pad=Math.round(out.width*0.03);
    const targetW=Math.round(out.width*0.24); // ~bottom-right
    const ratio=sigImg.height/sigImg.width;
    const targetH=Math.round(targetW*ratio);
    const x=out.width-targetW-pad;
    const y=out.height-targetH-pad;
    octx.save();
    octx.shadowColor="rgba(0,0,0,.18)";
    octx.shadowBlur=Math.round(out.width*0.008);
    octx.drawImage(sigImg,x,y,targetW,targetH);
    octx.restore();
  }

  const url=out.toDataURL("image/jpeg",0.95);
  const a=document.createElement("a");
  a.href=url;
  a.download=withSig ? "signed_masterpiece.jpg" : "masterpiece.jpg";
  a.click();
}

// close modal by clicking backdrop
sigModal.addEventListener("pointerdown",(e)=>{if(e.target===sigModal) closeSig();});
</script>
</body></html>
